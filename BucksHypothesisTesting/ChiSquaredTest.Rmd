---
title: "Chi-Squared Tests for Account Dataset 2023 & 2024"
date: 'Date: May 3, 2025'
output: html_notebook
---

# Reading in the Dataset
We start off by reading the `.csv` file into a dataframe. This will allow us to perform the necessary operations 
needed to extract the data that we're concerned about, as well as perform the statistical tests, which can give us 
more insights into the data. 

**Note:** it is worth noting that we apply the bonferroni correction to all of our testing as well as set the 
signifigance level to 0.05.

```{r setup, message=FALSE, warning=FALSE}

library(dplyr)
library(ggplot2)
library(rlang)
library(gridExtra)

# reading in the account data into data frames
account_2023 <- read.csv("C:/GitHub/BucksHackathon25/BucksDatasets/AccountLevel_2023.csv")
account_2024 <- read.csv("C:/GitHub/BucksHackathon25/BucksDatasets/AccountLevel_2024.csv")

# reading in the account/seat data into data frames
account_seat_2023 <- read.csv("C:/GitHub/BucksHackathon25/BucksDatasets/ALSL_2023.csv")
account_seat_2024 <- read.csv("C:/GitHub/BucksHackathon25/BucksDatasets/ALSL_2024.csv")

```

## Function for Perfoming Chi-Sqaured Test
Before we perform any chi-sqaured tests, we would like to create a function that is designed to perform a 
chi-squared test on the features that we're interested in, as this would save us from writing multiple lines of 
code.

```{r}

# function for performing a chi-squared test
run_chi_squared_test <- function(dataset, feature_one, feature_two) {

    # creating a contingency table
    contingency_table <- table(dataset[[feature_one]], dataset[[feature_two]])

    # running the chi-squared test
    chi_results <- chisq.test(contingency_table)

    # determing statistical signifigance
    if(chi_results$p.value < 0.05) {
        print("Statistical Signifigance is Present")

        posthoc_result <- rcompanion::pairwiseNominalIndependence(
        contingency_table,
        chisq = TRUE,
        fisher = FALSE,
        method = "bonferroni"
      )
      print(posthoc_result)

    } else {
        print("No Statistical Signifigance Detected")
    }

}


```

## Chi-Squared Test on STM vs FanSegment
After establishing the function, we now decide to conduct a chi-squared test on STM against the FanSegment feature. We also perform a post-hoc pairwise test.
The Null and Alternative Hypothesis is stated as follows:
- **Null Hypothesis:** there is no association between STM and FanSegment
- **Alternative Hypothesis:** there is an association between STM and FanSegment

```{r}

# running the chi-squared test function for the 2023 dataset
run_chi_squared_test(account_2023, 'FanSegment', 'STM')

# running the chi-squared test function for the 2024 dataset
run_chi_squared_test(account_2024, 'FanSegment', 'STM')


```

For the 2023 dataset, we interpret the results as follows:
- C vs A
- D vs A, B
- E vs A, B 
- F vs A, B, C and D
- G vs A, B, C, D, E, F

For the 2024 dataset, we interpret the results as follows: 
- B vs A 
- C vs A, B 
- D vs A, B 
- E vs A, B 
- F vs A, B, D, E 
- G vs A, B, C, D, E, F

## Chi-Squared Test on FanSegment vs GameTier
After establishing the function, we now decide to conduct a chi-squared test on FanSegment against the GameTier feature. We also perform a post-hoc pairwise 
test. The Null and Alternative Hypothesis is stated as follows:
- **Null Hypothesis:** there is no association between GameTier and FanSegment
- **Alternative Hypothesis:** there is an association between GameTier and FanSegment

```{r}
# running the chi-squared test function for the 2023 dataset
run_chi_squared_test(account_seat_2023, 'GameTier', 'FanSegment')

# running the chi-squared test function for the 2024 dataset
run_chi_squared_test(account_seat_2024, 'GameTier', 'FanSegment')

```

For the 2023 dataset, we interpret the results as follows:
- C vs A, B 
- E vs C 
- F vs C, D 
- G vs F 

For the 2024 dataset, we interpret the results as follows:
- B vs A 
- C vs A 
- D vs A 
- E vs A 
- F vs A 
- G vs A, B, D, E

## Chi-Squared Test on SocialMediaEngagement vs GameTier
After establishing the function, we now decide to conduct a chi-squared test on SocialMediaEngagement against the GameTier feature. We also perform a 
post-hoc pairwise test. The Null and Alternative Hypothesis is stated as follows:
- **Null Hypothesis:** there is no association between SocialMediaEngagement and GameTier
- **Alternative Hypothesis:** there is an association between SocialMediaEngagement and GameTier

```{r}
# running the chi-squared test function for the 2023 dataset
run_chi_squared_test(account_seat_2023, 'GameTier', 'SocialMediaEngagement')

# running the chi-squared test function for the 2024 dataset
run_chi_squared_test(account_seat_2024, 'GameTier', 'SocialMediaEngagement')


```

For the 2023 dataset, we interpret the results as follows:
- A vs D 
- B vs C 
- C vs D 

For the 2024 dataset, we interpret the results as follows:
- A vs D 
- B vs D 
- C vs D 

## Chi-Squared Test on STM vs GameTier 
After establishing the function, we now decide to conduct a chi-squared test on STM against the GameTier feature. We also perform a post-hoc pairwise test. 
The Null and Alternative Hypothesis is stated as follows:
- **Null Hypothesis:** there is no association between STM and GameTier
- **Alternative Hypothesis:** there is an association between STM and GameTier

```{r}

# running the chi-squared test function for the 2023 dataset
run_chi_squared_test(account_seat_2023, 'GameTier', 'STM')

# running the chi-squared test function for the 2024 dataset
run_chi_squared_test(account_seat_2024, 'GameTier', 'STM')


```

For the 2023 dataset, we interpret the results as follows:
- None 

For the 2024 dataset, we interpret the results as follows:
- A vs B 
- A vs C 
- A vs D 
- B vs C 
- B vs D 
- C vs D 


## Function for Creating a Heat Map
Now, we would like to function that is designed to plot out a heat map. This will help visualize some of the 
statistical testing that we've done.

```{r}

# calling the library
library(ggplot2)
library(dplyr)

# function for plotting out a heat map
plot_heat_map <- function(dataset, variable_one, variable_two, title, year, level_vector) {

    dataset[[variable_one]] <- as.factor(dataset[[variable_one]])
    dataset[[variable_two]] <- as.factor(dataset[[variable_two]])

    dataset <- dataset %>% filter(.data[[variable_two]] %in% level_vector)
    dataset[[variable_two]] <- factor(dataset[[variable_two]], levels = level_vector)

    plot_data <- dataset %>% count(.data[[variable_one]], .data[[variable_two]])

    # plotting out the heat maps
    p <- ggplot(plot_data, aes(x = .data[[variable_one]], y = .data[[variable_two]], fill = n)) +
        geom_tile(color ="#00471B") +
        scale_fill_gradient(low = "#EAF1E8", high = "#00471B") +
        labs(title = title, x = variable_one, y = variable_two, fill='Count') +
        theme(
            panel.background = element_rect(fill = "#EEE1C6", color = NA),
            plot.background  = element_rect(fill = "#EEE1C6", color = NA),
            panel.border     = element_rect(color = "black", fill = NA, linewidth = 0.8),
            panel.grid.major = element_blank(),
            panel.grid.minor = element_blank()
        )

    # creating the filename
    filename <- paste0("C:/GitHub/BucksHackathon25/BucksHypothesisTesting/ChiSquaredPlots", year,
    "/",title, ".png")

    #saving the plot in a directory
    ggsave(filename, plot = p, width = 6, height = 4, dpi=300, bg='white')
}


```

## Creating Heat Maps Using Our Function
Now, we decide to create heat maps using the function we created. This will allow us to visualize the relationships between the features.

```{r}

# setting up a list of vectors for 2023
vector_list_2023 <- list(
    c("C", "A"),
    c("D", "A"),
    c("D", "B"),
    c("E", "A"),
    c("E", "B"),
    c("F", "A"),
    c("F", "B"),
    c("F", "C"),
    c("F", "D"),
    c("G", "A"),
    c("G", "B"),
    c("G", "C"),
    c("G", "D"),
    c("G", "E"),
    c("G", "F")
)

# setting up a list of vectors for 2024
vector_list_2024 <- list(
  c("B", "A"),
  c("C", "A"),
  c("C", "B"),
  c("D", "A"),
  c("D", "B"),
  c("E", "A"),
  c("E", "B"),
  c("F", "A"),
  c("F", "B"),
  c("F", "D"),
  c("F", "E"),
  c("G", "A"),
  c("G", "B"),
  c("G", "C"),
  c("G", "D"),
  c("G", "E"),
  c("G", "F")


)

# for looping and calling the function for 2023
for(vec in vector_list_2023) {
    title <- paste("STM-Engangement Heat Map for", vec[1], "vs", vec[2], "2023")
    plot_heat_map(account_2023, 'STM', 'FanSegment', title, 2023, vec)
}

# for looping and calling the function for 2024
for(vec in vector_list_2024) {
    title <- paste("STM-Engangement Heat Map for", vec[1], "vs", vec[2], "2024")
    plot_heat_map(account_2024, 'STM', 'FanSegment', title, 2024, vec)
}


```

```{r}

vector_list_2023 <- list(
    c("C", "A"),
    c("C", "B"),
    c("E", "C"),
    c("F", "C"),
    c("F", "D"),
    c("G", "F")
)

vector_list_2024 <- list(
    c("B", "A"),
    c("C", "A"),
    c("D", "A"),
    c("E", "A"),
    c("F", "A"),
    c("G", "A"),
    c("G", "B"),
    c("G", "D"),
    c("G", "E")
)

# for looping and calling the function for 2023
for(vec in vector_list_2023) {
    title <- paste("GameTier-FanSegment Heat Map for", vec[1], "vs", vec[2], "2023")
    plot_heat_map(account_seat_2023, 'GameTier', 'FanSegment', title, 2023, vec)
}

# for looping and calling the function for 2024
for(vec in vector_list_2024) {
    title <- paste("GameTier-FanSegment Heat Map for", vec[1], "vs", vec[2], "2024")
    plot_heat_map(account_seat_2024, 'GameTier', 'FanSegment', title, 2024, vec)
}

```

```{r}

vector_list_2024 <- list(
    c("A", "B"),
    c("A", "C"),
    c("A", "D"),
    c("B", "C"),
    c("B", "D"),
    c("C", "D")
)

# for looping and calling the function for 2024
for(vec in vector_list_2024) {
    title <- paste("GameTier-STM Heat Map for", vec[1], "vs", vec[2], "2024")
    plot_heat_map(account_seat_2024, 'GameTier', 'STM', title, 2024, vec)
}


```

```{r}

vector_list_2023 <- list(
    c("A", "D"),
    c("B", "C"),
    c("C", "D")
)

vector_list_2024 <- list(
    c("A", "D"),
    c("B", "D"),
    c("C", "D")
)

# for looping and calling the function for 2023
for(vec in vector_list_2023) {
    title <- paste("GameTier-SocialMediaEngagement Heat Map for", vec[1], "vs", vec[2], "2023")
    plot_heat_map(account_seat_2023, 'GameTier', 'SocialMediaEngagement', title, 2023, vec)
}

# for looping and calling the function for 2024
for(vec in vector_list_2024) {
    title <- paste("GameTier-SocialMediaEngagement Heat Map for", vec[1], "vs", vec[2], "2024")
    plot_heat_map(account_seat_2024, 'GameTier', 'SocialMediaEngagement', title, 2024, vec)
}


```