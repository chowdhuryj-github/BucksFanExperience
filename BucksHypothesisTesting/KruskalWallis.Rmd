---
title: "Kruskal Wallis Tests for Account Dataset 2023 & 2024"
date: 'Date: May 3, 2025'
output: html_notebook
---

# Reading in the Dataset
We start off by reading the `.csv` file into a dataframe. This will allow us to perform the necessary operations 
needed to extract the data that we're concerned about, as well as perform the statistical tests, which can give us 
more insights into the data. 

**Note:** it is worth noting that we apply the bonferroni correction to all of our testing as well as set the 
signifigance level to 0.05.

```{r setup, message=FALSE, warning=FALSE}

library(dplyr)
library(ggplot2)
library(rlang)
library(gridExtra)

# reading in the account data into data frames
ALGLSL_2023 <- read.csv("C:/GitHub/BucksHackathon25/BucksDatasets/ALGLSL_2023.csv")
ALGLSL_2024 <- read.csv("C:/GitHub/BucksHackathon25/BucksDatasets/ALGLSL_2024.csv")
CustomerPlans <- read.csv("C:/GitHub/BucksHackathon25/BucksDatasets/CustomerPlans_2023.csv")


```

## Kruskal Wallis Test on AvgSpend and FanSegment
Now that we've read the data into a data frame, we would like to perform a kruskal wallis test on the AvgSpend vs the FanSegment from both datasets. This
will allow us compare a numerical variable against a categorical variable with multiple values. 

- **Null Hyypothesis:** the distribution of average spending is the same across all segments
- **Alternative Hypothesis:** atleast one fan segment has a different distribution of average spending compared to others

```{r}

# performing a kruskal-wallis test
kruskal_one <- kruskal.test(AvgSpend ~ FanSegment, data=ALGLSL_2023)
print(kruskal_one)


```

```{r}

# setting the data type as factor
ALGLSL_2023$FanSegment <- as.factor(ALGLSL_2023$FanSegment)


# performing the pair wise testing
rank_sum_one <- pairwise.wilcox.test(
    x = ALGLSL_2023$AvgSpend, 
    g = ALGLSL_2023$FanSegment, 
    p.adjust.method = "bonferroni")

# printg out the results
print(rank_sum_one)


```

```{r}

# performing a kruskal-wallis test
kruskal_two <- kruskal.test(AvgSpend ~ FanSegment, data=ALGLSL_2024)
print(kruskal_two)

# setting the data type as factor
ALGLSL_2024$FanSegment <- as.factor(ALGLSL_2024$FanSegment)

# performing the pair wise testing
rank_sum_two <- pairwise.wilcox.test(
    x = ALGLSL_2024$AvgSpend, 
    g = ALGLSL_2024$FanSegment, 
    p.adjust.method = "bonferroni")

# printg out the results
print(rank_sum_two)


```

## Creating a Function for Performing Kruskal-Wallis Tests
Understanding the Kurskal-Wallis process, we decide to make a function that will make the process a whole lot easier

```{r}

# function for performing kruskal-wallis testing
run_kruskal_wallis <- function(dataset, response, group) {

    # performing the kruskal wallis test
    formula <- as.formula(paste(response, "~", group))
    kruskal_result <- kruskal.test(formula, data=dataset)
    print(kruskal_result)

    # accessing the p-value
    if(kruskal_result$p.value < 0.05) {
        cat("\n p-value is significant, running pairwise wilcox test \n")
        rank_sum_two <- pairwise.wilcox.test(
        x = dataset[[response]], 
        g = dataset[[group]], 
        p.adjust.method = "bonferroni")
        print(rank_sum_two)
    } else {
        cat("\n p-value is not significant \n")
    }

}

# testing out the function
run_kruskal_wallis(ALGLSL_2024, 'AvgSpend', 'FanSegment')

```

## Kruskal Wallis Test on SocialMediaEngagement and BasketballPropensity
Next, we move on to performing the Kruskal-Wallis test on SocialMediaEngagement vs BasketballPropensity. As SocialMediaEngagement is a categorical 
feature with three distinct values of Low, Medium and High, we set the null and alternative hypothesis as follows:

- **Null Hypothesis:** the distribution of average propensity is the same across all engagement groups
- **Alternative Hypothesis:** atleast one engagement category has a different distribution of propensity compared to others

```{r}

# running the kruskal-wallis test for the 2023 dataset
run_kruskal_wallis(ALGLSL_2023, 'BasketballPropensity', 'SocialMediaEngagement')

# running the kruskal-wallis test for the 2024 dataset
run_kruskal_wallis(ALGLSL_2024, 'BasketballPropensity', 'SocialMediaEngagement')


```

## Kruskal Wallis Test on FanSegment and DistanceToArena
Next, we move on to performing the Kruskal-Wallis test on FanSegment vs DistanceToArena. As FanSegment is a categorical feature with multiple distinct 
features, we set the null and alternative hypothesis as follows:

 - **Null Hypothesis:** the distribution of distance to arena is the same across all fan segment groups
 - **Alternative Hypothesis:** atleast one fan segment has a different distribution of distance compared to others

```{r}

# running the kruskal-wallis test for the 2023 dataset
run_kruskal_wallis(ALGLSL_2023, 'DistanceToArena', 'FanSegment')

# running the kruskal-wallis test for the 2024 dataset
run_kruskal_wallis(ALGLSL_2024, 'DistanceToArena', 'FanSegment')


```

## Kruskal Wallis Test on AvgSpend and SocialMediaEngagement
Next, we move on to performing the Kruskal-Wallis test on AvgSpend vs SocialMediaEngagement. As SocialMediaEngagement is a categorical feature with 
multiple distinct features, we set the null and alternative hypothesis as follows:

 - **Null Hypothesis:** the distribution of average spending is the same across all engagement groups
 - **Alternative Hypothesis:** atleast one engagement has a different distribution of average spending compared to others

```{r}

# running the kruskal-wallis test for the 2023 dataset
run_kruskal_wallis(ALGLSL_2023, 'AvgSpend', 'SocialMediaEngagement')

# running the kruskal-wallis test for the 2024 dataset
run_kruskal_wallis(ALGLSL_2024, 'AvgSpend', 'SocialMediaEngagement')


```

## Kruskal Wallis Test on FanSegment and GamesAttended
Next, we move on to performing the Kruskal-Wallis test on FanSegment vs GamesAttended. As FanSegment is a categorical feature with 
multiple distinct features, we set the null and alternative hypothesis as follows:

 - **Null Hypothesis:** the distribution of games attended is the same across all fan segment groups
 - **Alternative Hypothesis:** atleast one fan segment has a different distribution of games attended compared to others

```{r}

# running the kruskal-wallis test for the 2023 dataset
run_kruskal_wallis(ALGLSL_2023, 'GamesAttended', 'FanSegment')

# running the kruskal-wallis test for the 2024 dataset
run_kruskal_wallis(ALGLSL_2024, 'GamesAttended', 'FanSegment')


```


## Kruskal Wallis Test on SocialMediaEngagement and GamesAttended
Next, we move on to performing the Kruskal-Wallis test on GamesAttended vs SocialMediaEngagement. As SocialMediaEngagement is a categorical feature with 
multiple distinct features, we set the null and alternative hypothesis as follows:

 - **Null Hypothesis:** the distribution of games attended is the same across all engagement groups
 - **Alternative Hypothesis:** atleast one engagement group has a different distribution of games attended compared to others

```{r}

# running the kruskal-wallis test for the 2023 dataset
run_kruskal_wallis(ALGLSL_2023, 'GamesAttended', 'SocialMediaEngagement')

# running the kruskal-wallis test for the 2024 dataset
run_kruskal_wallis(ALGLSL_2024, 'GamesAttended', 'SocialMediaEngagement')


```

## Kruskal Wallis Test on DistanceToArena and GameTier
Next, we move on to performing the Kruskal-Wallis test on DistanceToArena vs GameTier. As GameTier is a categorical feature with  multiple distinct features, 
we set the null and alternative hypothesis as follows:

 - **Null Hypothesis:** the distribution of DistanceToArena is the same across all tier groups
 - **Alternative Hypothesis:** atleast one tier group has a different distribution of DistanceToArena compared to others

```{r}

# running the kruskal-wallis test for the 2023 dataset
run_kruskal_wallis(ALGLSL_2023, 'DistanceToArena', 'GameTier')

# running the kruskal-wallis test for the 2024 dataset
run_kruskal_wallis(ALGLSL_2024, 'DistanceToArena', 'GameTier')


```


## Kruskal Wallis Test on GamesAttended and FanSegment 
Next, we move on to performing the Kruskal-Wallis test on GamesAttended vs FanSegment. As FanSegment is a categorical feature with multiple distinct features, 
we set the null and alternative hypothesis as follows:

 - **Null Hypothesis:** the distribution of GamesAttended is the same across all tier groups
 - **Alternative Hypothesis:** atleast one FanSegment group has a different distribution of GamesAttended compared to others

```{r}

# running the kruskal-wallis test for the 2023 dataset
run_kruskal_wallis(ALGLSL_2023, 'GamesAttended', 'FanSegment')

# running the kruskal-wallis test for the 2024 dataset
run_kruskal_wallis(ALGLSL_2024, 'GamesAttended', 'FanSegment')


```

## Kruskal Wallis Test on Cluster and BasketballPropensity, AvgSpend, GamesAttended, DistanceToArena

```{r}

features = c('BasketballPropensity', 'AvgSpend', 'GamesAttended', 'DistanceToArena')
for (feature in features) {
    run_chi_squared_test(CustomerPlans, 'Cluster', feature)
}

```
